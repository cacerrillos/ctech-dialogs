<!DOCTYPE html>
<dom-module id="ctech-confirm-dialog">
  <link rel="import" href="../polymer/polymer.html">
  <link rel="import" href="../paper-dialog/paper-dialog.html">
  <link rel="import" href="../paper-icon-button/paper-icon-button.html">
  <link rel="import" href="../iron-icons/iron-icons.html">
  <link rel="import" href="../paper-button/paper-button.html">
  <link rel="import" href="../neon-animation/animations/scale-up-animation.html">
  <link rel="import" href="../neon-animation/animations/fade-out-animation.html">
  <template>
    <style>
      paper-dialog {
        background-color: white;
        min-width: 300px;
        min-height: 64px;
        @apply(--ctech-confirm-dialog);
      }
      .close-button {
        position: absolute;
        top: 0;
        right: 0;
      }
      .dialog-content {
        padding-left: 20px;
        padding-right: 20px;
      }
    </style>
    <paper-dialog id="mainDialog" on-iron-overlay-closed="doDismiss" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]" modal="{{modal}}">
      <div><paper-icon-button icon="icons:close" class="close-button" dialog-dismiss></paper-icon-button></div>
      <div class="dialog-content"><content id="content"></content></div>
      <div class="layout horizontal">
        <paper-button id="confirmButton" raised on-click="doConfirm" dialog-confirm>[[confirmText]]</paper-button>
        <paper-button raised dialog-dismiss>Cancel</paper-button>
        <div class="flex"></div>
      </div>
    </paper-dialog>
  </template>
  <script>
  Polymer({
    is: "ctech-confirm-dialog",
    properties: {
      entryAnimation: {
        type: String,
        value: "scale-up-animation"
      },
      exitAnimation: {
        type: String,
        value: "fade-out-animation"
      },
      dialogType: {
        type: String,
        value: "confirm"
      },
      invalid: {
        type: Boolean,
        value: false,
        observer: '_invalidChanged'
      },
      validColor: {
        type: String,
        value: "#4285f4"
      },
      confirmText: {
        type: String,
        value: "Accept"
      },
      modal: {
        type: Boolean,
        value: false,
        notfiy: true
      },
      cofirmOnEnter: {
        type: Boolean,
        value: true
      },
      resetOnConfirm: {
        type: String,
        value: "false"
      },
      resetOnDismiss: {
        type: String,
        value: "true"
      }
    },
    listeners: {
      'keydown': '_checkKeydown',
      'input': '_validateForm',
      'ctech-select': '_validateForm',
      'ctech-deselect': '_validateForm'
    },
    getDialog: function() {
      return this.$.mainDialog;
    },
    doConfirm: function() {
      if(!this.invalid) {
        if(this.resetOnConfirm === "true") {
          this.resetForm();
        }
        this.fire('ctech-dialog-confirm');
        return true;
      }
      return false;
    },
    doDismiss: function(e) {
      if(e.target == this.$.mainDialog) {
        if(this.resetOnDismiss === "true") {
          this.resetForm();
        }
        this.fire('ctech-dialog-dismiss');
      }
    },
    _checkKeydown: function(e) {
      if(e.keyCode == 13 && this.cofirmOnEnter) {
        this.doConfirm();
      }
    },
    _invalidChanged: function(e) {
      if(!e) {
        this.$.confirmButton.style.backgroundColor = this.validColor;
        this.$.confirmButton.style.color = "white";
        this.$.confirmButton.disabled = false;
      } else {
        this.$.confirmButton.style.backgroundColor = "#eaeaea";
        this.$.confirmButton.style.color = "#a8a8a8";
        this.$.confirmButton.disabled = true;
      }
    },
    _validateForm: function(e) {
      var valid = true;
      var content_elements = this.getContentChildren("#content");
      for(var x = 0; x < content_elements.length; x++) {
        $(content_elements[x]).find(".ctech-input").each(function(i, v) { 
          if(typeof v.value === 'undefined') {
            valid = false;
          } else {
            valid = valid && v.value.length > 0;
          }
         });
        $(content_elements[x]).find(".ctech-input-selector").each(function(i, v) { 
          if(typeof v.selected === 'undefined') {
            valid = false;
          } else {
            valid = valid && v.selected !== null;
          }
         });
      }
      this.invalid = !valid;
    },
    resetForm: function(e) {
      var content_elements = this.getContentChildren ("#content");
      for(var x = 0; x < content_elements.length; x++) {
        $(content_elements[x]).find(".ctech-input").each(function(i, v) { v.value = ""; });
        $(content_elements[x]).find(".ctech-input-selector").each(function(i, v) { v.select(); });
      }
      this.invalid = true;
    },
    assignParentResizeable: function(parentResizeable) {
      return this.$.mainDialog.assignParentResizeable(parentResizeable);
    },
    cancel: function() {
      return this.$.mainDialog.cancel();
    },
    cancelAnimation: function() {
      return this.$.mainDialog.cancelAnimation();
    },
    center: function() {
      return this.$.mainDialog.center();
    },
    close: function() {
      return this.$.mainDialog.close();
    },
    constrain: function() {
      return this.$.mainDialog.constrain();
    },
    fit: function() {
      return this.$.mainDialog.fit();
    },
    getAnimationConfig: function(type) {
      return this.$.mainDialog.getAnimationConfig(type);
    },
    notifyResize: function() {
      return this.$.mainDialog.notifyResize();
    },
    open: function() {
      return this.$.mainDialog.open();
    },
    playAnimation: function(type, cookie) {
      return this.$.mainDialog.playAnimation(type, cookie);
    },
    refit: function() {
      return this.$.mainDialog.refit();
    },
    resetFit: function() {
      return this.$.mainDialog.resetFit();
    },
    resizerShouldNotify: function(element) {
      return this.$.mainDialog.resizerShouldNotify(element);
    },
    stopResizeNotificationsFor: function(target) {
      return this.$.mainDialog.stopResizeNotificationsFor(target);
    },
    toggle: function() {
      return this.$.mainDialog.toggle();
    },
    ready: function(){
      this._invalidChanged();
      this._validateForm();
    }
  });
  </script>
</dom-module>